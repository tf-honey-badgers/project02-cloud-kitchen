<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="org.badgers.rest.customer.order.persistence.CustOrderMapper">

	<insert id="initOrder"
		parameterType="org.badgers.rest.model.CustomerVO">
		insert into honey_badgers.order (
		id , phone, address , msg, pay_amt, kitchen_name, cust_id)
		values(#{id},#{phone},#{address},#{msg}, #{payAmt}, #{kitchenName}, #{custId});
	</insert>

	<insert id="initOrderDetail">
		insert into honey_badgers.order_detail 
			(id, quantity, menu_price, add_option_price, total_amt, biz_name, biz_id, menu_id, ,request_msg, order_id) 
		values
			(#{id}, #{quantity}, #{menuPrice},#{addOptionPrice}, #{totalAmt},#{bizName}, #{bizId}, #{menuId}, #{requestMsg}, #{orderId})

	</insert>
	<insert id="initOrderMenuOption">
		insert into order_menu_option 
			(opt_name, opt_price, opt_id, order_detail_id)
		values
			(#{optName},#{optPrice},#{optId},#{orderDetailId})

	</insert>

	<select id="getOrderInfo"
		resultType="org.badgers.rest.model.OrderInfoVO">
		select * from
		(
		select * from
		honey_badgers.order o,(
		select order_detail_id, quantity, menu_price, add_option_price,
		total_amt,biz_name,opt_name,opt_price,opt_id ,d.order_id from (SELECT
		id as order_detail_id,quantity, menu_price,add_option_price,
		total_amt, biz_name, order_id FROM order_detail) d
		LEFT JOIN (select opt_name, opt_price, opt_id, order_detail_id as
		order_opt_order_detail_id from order_menu_option) p ON
		d.order_detail_id = p.order_opt_order_detail_id
		) k
		where k.order_id = o.id
		) l
		where l.id=#{orderId}

	</select>



	<select id="test" resultType="org.badgers.rest.model.OrderVO">
		select * from honey_badgers.order
		where id=#{orderId}
	</select>

	<select id="getOrder"
		resultType="org.badgers.rest.model.OrderVO">
		select * from honey_badgers.order
	</select>
</mapper>